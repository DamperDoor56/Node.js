<%- include("template/cabecera" , {tituloWeb: 'Detalle de publicacion'})  %>  

    <body>
        <div class="container-details">
            <h1>Detalles</h1>
            <% if(error) { %>
                <p>
                    <%= message %> 
                </p>
            <% } %>
           
        
        <% if (!error) { %>

            <form id="formEdit">
                <input 
                    type="text"
                    class="form-c"
                    name="titulo"
                    value="<%= publicacion.titulo %>"
                    id="tituloInput"
                    >
                    <input 
                    type="text"
                    class="form-c"
                    name="descripcion"
                    value="<%= publicacion.descripcion %>"
                    id="descripcionInput"
                    >
                        <button
                        class="btnEdit">
                        Update
                        </button>
                        <button 
                        id="btnDelete"
                        data-id="<%= publicacion.id %>">
                        Delete
                        </button>
            </form>

        <% } %>
        <a href="/publicacion">Return to Home</a>
</div>
<%- include("template/footer") %>  
<!-- *Method = POST to use router.post -->
<script>

// Delete logic
    const btnDelete = document.querySelector("#btnDelete")

    btnDelete.addEventListener('click', async() =>{
        const id = btnDelete.dataset.id 
    try {
        const data = await fetch(`/publicacion/${btnDelete.dataset.id}`, {
          method: 'delete'
        })
        const res = await data.json()
        console.log(res)
        if(res.state){
            window.location.href = '/publicacion'
        }else{
            console.log(res)
        }
    } catch (error) {
        console.log(error)
    }
  })

  //Capture formEdit
  const formEdit = document.querySelector('#formEdit')

  formEdit.addEventListener('submit', (e) => {
    e.preventDefault() //Prevent refreshing
    
    const titulo = formEdit.elements['name'].value
    console.log(titulo)
  })
</script>